回测区间: 2020-01-01 - 2024-06-01
期初资产: 1000000.00
期末资产: 3026700.17
年化收益: 28.29%
年化波动: 25.26%
最大回撤: 22.03%
夏普比: 1.12

## 挑战复现80篇量化论文第42期-原油预测股票回报
回测区间: 2020-01-01 - 2024-06-01
期初资产: 1000000.00
期末资产: 3026700.17
年化收益: 28.29%
年化波动: 25.26%
最大回撤: 22.03%
夏普比: 1.12
### 策略概述 💡
本策略基于原油价格预测股市表现。研究表明，原油价格与未来股票回报存在负相关关系。较高的原油价格预示着未来股票回报较低，反之亦然。

### 关键要点 ✨
本策略依赖于投资者对原油价格变动的反应滞后性。这种滞后性可能是因为投资者难以评估原油价格变化对股票价值的影响，或投资者在不同时间点对信息作出反应。

### 交易资产 📦
本策略使用阿拉伯轻质原油价格作为主要独立变量，月度股市回报作为依赖变量。

### 交易策略 🛠️
每月重新估计回归模型，新增上月数据。根据回归结果判断当月预期股票市场回报是否高于无风险利率。

### 交易信号 📢
- 若预期回报高于无风险利率，投资者全额投资于市场组合（牛市）。
- 若预期回报低于无风险利率，投资者投资于现金（熊市）。

### 论文出处 📚
- Nonejad, Nima. "Equity premium prediction using the price of crude oil: Uncovering the nonlinear predictive impact." Energy Economics, 2022, vol. 115, issue C.
- QuantPedia. "Crude Oil Predicts Equity Returns."


```Python
import backtrader as bt
import yfinance as yf
import pandas as pd
import numpy as np
import warnings
warnings.filterwarnings('ignore')

class CrudeOilPredictor(bt.Strategy):
    def __init__(self):
        self.oil_data = self.datas[0]
        self.equity_data = self.datas[1]
        self.last_month = -1

    def next(self):
        current_month = self.data.datetime.date(0).month
        if current_month == self.last_month:
            return

        self.last_month = current_month
        oil_returns = (self.oil_data.close[0] / self.oil_data.close[-21]) - 1
        equity_returns = (self.equity_data.close[0] / self.equity_data.close[-21]) - 1

        # Perform regression
        X = np.array(oil_returns).reshape(-1, 1)
        y = np.array(equity_returns).reshape(-1, 1)
        regression = np.linalg.lstsq(X, y, rcond=None)[0]
        expected_return = regression[0][0] * oil_returns

        risk_free_rate = 0.0003  # 假设无风险利率为0.03%（每月）
        if expected_return > risk_free_rate:
            self.order_target_percent(target=1.0)
        else:
            self.order_target_percent(target=0.0)

    def log(self, txt, dt=None):
        dt = dt or self.datas[0].datetime.date(0)
        print(f'{dt.isoformat()} {txt}')

class PerformanceAnalyzer(bt.Analyzer):
    def __init__(self):
        self.rets = []

    def next(self):
        self.rets.append(self.strategy.broker.getvalue())

    def get_analysis(self):
        returns = np.diff(self.rets) / self.rets[:-1]
        annual_return = np.mean(returns) * 252
        annual_volatility = np.std(returns) * np.sqrt(252)
        sharpe_ratio = annual_return / annual_volatility

        cum_returns = np.maximum.accumulate(self.rets)
        drawdowns = (cum_returns - self.rets) / cum_returns
        max_drawdown = np.max(drawdowns)

        return {
            'portfolio_value': self.rets[-1],
            'annual_return': annual_return,
            'annual_volatility': annual_volatility,
            'sharpe_ratio': sharpe_ratio,
            'max_drawdown': max_drawdown
        }

if __name__ == '__main__':
    cerebro = bt.Cerebro()
    
    oil_data = bt.feeds.PandasData(dataname=yf.download('CL=F', start="2020-01-01", end="2024-06-01"))
    equity_data = bt.feeds.PandasData(dataname=yf.download('SPY', start="2020-01-01", end="2024-06-01"))

    cerebro.adddata(oil_data, name='Oil')
    cerebro.adddata(equity_data, name='Equity')

    cerebro.addstrategy(CrudeOilPredictor)
    cerebro.broker.set_cash(1000000)
    cerebro.broker.setcommission(commission=0.0)  # 设置无交易佣金

    cerebro.addanalyzer(PerformanceAnalyzer, _name='performance')

    print('期初资产: %.2f' % cerebro.broker.getvalue())
    results = cerebro.run()
    strat = results[0]
    print('回测区间: 2020-01-01 - 2024-06-01')
    print('期初资产: %.2f' % 1000000)
    print('期末资产: %.2f' % cerebro.broker.getvalue())

    performance = strat.analyzers.performance.get_analysis()
    print('年化收益: {:.2f}%'.format(performance['annual_return'] * 100))
    print('年化波动: {:.2f}%'.format(performance['annual_volatility'] * 100))
    print('最大回撤: {:.2f}%'.format(performance['max_drawdown'] * 100))
    print('夏普比: {:.2f}'.format(performance['sharpe_ratio']))

    cerebro.plot()

```